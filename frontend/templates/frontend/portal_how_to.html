{% extends 'frontend/base_portal.html' %}

{% block title %}¿Cómo Probar? | Genetic Timetable{% endblock %}

{% block content %}
<section class="py-12 px-4">
    <div class="max-w-7xl mx-auto">
        <div class="text-center mb-16">
            <h1 class="text-5xl font-extrabold mb-6 italic bg-clip-text text-transparent bg-gradient-to-r from-primary-400 to-purple-400">¿Cómo probar la plataforma?</h1>
            <p class="text-gray-400 max-w-2xl mx-auto text-lg leading-relaxed">
                Hemos diseñado dos rutas de prueba dependiendo de tu nivel técnico. Elige la que mejor se adapte a ti.
            </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <!-- Ruta 1: Perfil Técnico (API/Postman) -->
            <div class="flex flex-col h-full">
                <div class="glass p-10 rounded-[3rem] border-l-8 border-blue-500 flex-grow hover:bg-white/5 transition duration-500">
                    <div class="flex items-center gap-6 mb-8">
                        <div class="bg-blue-500/20 p-5 rounded-3xl text-blue-400 shadow-lg shadow-blue-500/10">
                            <i class="fas fa-code-branch text-3xl"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold">Perfil Técnico</h2>
                            <p class="text-blue-400 font-bold uppercase tracking-widest text-xs">Developers & QA Engineers</p>
                        </div>
                    </div>
                    
                    <div class="space-y-8 mb-10">
                        <div>
                            <h4 class="text-white font-bold mb-3 flex items-center gap-2">
                                <span class="bg-blue-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full">1</span>
                                Configura el Entorno
                            </h4>
                            <p class="text-gray-500 text-sm mb-4">Usa estos valores en tu cliente REST (Postman/Insomnia) para conectar con el servidor de producción.</p>
                            
                            <!-- Tabla de Variables Postman -->
                            <div class="overflow-hidden rounded-2xl border border-white/5">
                                <table class="w-full text-left text-sm">
                                    <thead class="bg-white/5 text-gray-400 font-bold">
                                        <tr>
                                            <th class="px-4 py-3">Variable</th>
                                            <th class="px-4 py-3">Valor / Acción</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-gray-500">
                                        <tr class="border-t border-white/5">
                                            <td class="px-4 py-3 font-mono text-blue-400">base_url</td>
                                            <td class="px-4 py-3">http://18.188.89.221</td>
                                        </tr>
                                        <tr class="border-t border-white/5 bg-white/5">
                                            <td class="px-4 py-3 font-mono text-purple-400">token</td>
                                            <td class="px-4 py-3 italic text-xs">Obtener vía POST /api/token/</td>
                                        </tr>
                                        <tr class="border-t border-white/5">
                                            <td class="px-4 py-3 font-mono text-orange-400">admin_url</td>
                                            <td class="px-4 py-3">No tocar (Interno)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div>
                            <h4 class="text-white font-bold mb-3 flex items-center gap-2">
                                <span class="bg-blue-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full">2</span>
                                Flujo de Pruebas Recomendado
                            </h4>
                            <ul class="text-gray-500 text-xs space-y-3 mb-4">
                                <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> <b>GET /api/estado-sistema/</b>: Verifica la conexión.</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> <b>GET /api/validar-prerrequisitos/</b>: Revisa si faltan datos.</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check text-green-400"></i> <b>POST /api/generar-horario/</b>: Ejecuta con <code>"preview": true</code>.</li>
                            </ul>
                        </div>
                    </div>

                    <a href="{% url 'docs_portal' %}" class="block text-center bg-blue-600 hover:bg-blue-700 py-4 rounded-2xl font-extrabold transition shadow-lg shadow-blue-600/20 transform hover:-translate-y-1">
                        <i class="fas fa-file-alt mr-2"></i> Ver Guía de Endpoints
                    </a>
                </div>
            </div>

            <!-- Ruta 2: Perfil No Técnico (Panel Visual) -->
            <div class="flex flex-col h-full">
                <div class="glass p-10 rounded-[3rem] border-l-8 border-purple-500 flex-grow hover:bg-white/5 transition duration-500">
                    <div class="flex items-center gap-6 mb-8">
                        <div class="bg-purple-500/20 p-5 rounded-3xl text-purple-400 shadow-lg shadow-purple-500/10">
                            <i class="fas fa-desktop text-3xl"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold">Perfil No Técnico</h2>
                            <p class="text-purple-400 font-bold uppercase tracking-widest text-xs">Coordinadores & Rectores</p>
                        </div>
                    </div>

                    <div class="space-y-8 mb-10">
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 flex-shrink-0">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold mb-1">Acceso Directo</h4>
                                <p class="text-gray-500 text-sm">Entra al panel administrativo y usa las credenciales <code>admin / admin</code> (solo para demo local).</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 flex-shrink-0">
                                <i class="fas fa-magic"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold mb-1">Generación Un-Clic</h4>
                                <p class="text-gray-500 text-sm">Presiona el botón "Generar" y observa cómo la IA resuelve los conflictos automáticamente.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 flex-shrink-0">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold mb-1">Visualización</h4>
                                <p class="text-gray-500 text-sm">Navega por los horarios de cada curso y profesor en una interfaz amigable.</p>
                            </div>
                        </div>
                    </div>

                    <a href="{% url 'panel_coordinador' %}" class="block text-center bg-purple-600 hover:bg-purple-700 py-4 rounded-2xl font-extrabold transition shadow-lg shadow-purple-600/20 transform hover:-translate-y-1">
                        <i class="fas fa-rocket mr-2"></i> Ir al Panel Visual
                    </a>
                </div>
            </div>
        </div>

        <!-- Demo Mode Section Renovado -->
        <div class="mt-20 relative">
            <div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-purple-600/10 blur-3xl rounded-full"></div>
            <div class="relative glass p-12 rounded-[3.5rem] border border-white/10 text-center">
                <div class="inline-block bg-white/5 border border-white/10 px-6 py-2 rounded-full text-xs font-bold uppercase tracking-[0.3em] mb-6">
                    Acceso Instantáneo
                </div>
                <h3 class="text-4xl font-bold mb-6">¿Quieres una prueba rápida?</h3>
                <p class="text-gray-400 text-lg mb-10 max-w-2xl mx-auto">
                    Si no tienes tiempo para configurar nada, nuestro <b>Modo Demo</b> te genera un token de acceso temporal válido por 30 minutos para explorar la API.
                </p>
                <button id="btn-guest-token" class="bg-gradient-to-r from-blue-600 to-purple-600 px-12 py-5 rounded-2xl font-extrabold hover:opacity-90 transition transform hover:scale-105 shadow-2xl shadow-purple-600/20">
                    <i class="fas fa-key mr-2"></i> Activar Modo Demo
                </button>
                
                <div id="demo-result" class="hidden mt-10 p-8 bg-black/40 rounded-[2rem] border border-white/5 text-left max-w-3xl mx-auto">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-xs font-bold text-green-400 uppercase tracking-widest"><i class="fas fa-check-circle mr-1"></i> Token Activo</span>
                        <span class="text-[10px] text-gray-500">Expira en 30m</span>
                    </div>
                    <div class="relative group">
                        <div class="absolute -inset-1 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl blur opacity-25 group-hover:opacity-50 transition"></div>
                        <div class="relative bg-gray-900 rounded-xl p-5 font-mono text-xs break-all text-blue-300 border border-white/5">
                            <code id="token-display">Cargando...</code>
                        </div>
                    </div>
                    <p class="mt-4 text-xs text-gray-500 text-center italic">Usa este token en el header <code>Authorization: Bearer [TOKEN]</code></p>
                    
                    <div class="mt-6">
                        <p class="text-[10px] text-gray-500 uppercase font-bold mb-2">Tip: Post-response Script (Postman)</p>
                        <div class="bg-black/60 rounded-xl p-4 font-mono text-[10px] text-gray-400 border border-white/5">
                            pm.environment.set("access_token", pm.response.json().access);
                        </div>
                    </div>
                </div>
            </div>
        </div>
            <!-- Ejemplos cURL -->
            <div class="mt-20 glass p-10 rounded-[3rem] border border-white/10">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fas fa-terminal text-primary-400"></i>
                    <h3 class="text-2xl font-bold">Ejemplos rápidos con cURL</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 font-mono text-xs">
                    <div class="bg-black/40 p-4 rounded-2xl border border-white/5">
                        <p class="text-[10px] text-gray-500 uppercase font-bold mb-2">Token Demo</p>
                        <pre class="text-gray-300 whitespace-pre-wrap">curl -X POST http://127.0.0.1:8000/api/auth/guest/</pre>
                    </div>
                    <div class="bg-black/40 p-4 rounded-2xl border border-white/5">
                        <p class="text-[10px] text-gray-500 uppercase font-bold mb-2">Estado del Sistema</p>
                        <pre class="text-gray-300 whitespace-pre-wrap">curl -H "Authorization: Bearer &lt;TOKEN&gt;" http://127.0.0.1:8000/api/estado-sistema/</pre>
                    </div>
                    <div class="bg-black/40 p-4 rounded-2xl border border-white/5">
                        <p class="text-[10px] text-gray-500 uppercase font-bold mb-2">Generar en modo preview</p>
                        <pre class="text-gray-300 whitespace-pre-wrap">curl -X POST http://127.0.0.1:8000/api/generar-horario/ ^
-H "Content-Type: application/json" ^
-H "Authorization: Bearer &lt;TOKEN&gt;" ^
-d "{ \\"generaciones\\": 100, \\"preview\\": true }"</pre>
                    </div>
                </div>
            </div>

    </div>
</section>
{% endblock %}


{% block extra_scripts %}
<script>
    document.getElementById('btn-guest-token')?.addEventListener('click', async () => {
        const btn = document.getElementById('btn-guest-token');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Generando...';
        
        try {
            const response = await fetch('/api/auth/guest/', { method: 'POST' });
            const data = await response.json();
            const resultDiv = document.getElementById('demo-result');
            const tokenCode = document.getElementById('token-display');
            
            resultDiv.classList.remove('hidden');
            tokenCode.innerText = data.access;
            btn.innerHTML = '<i class="fas fa-check mr-2"></i> ¡Token Generado!';
            btn.classList.add('bg-green-600');
            
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } catch (error) {
            console.error('Error:', error);
            btn.innerHTML = '<i class="fas fa-times mr-2"></i> Error';
        }
    });
</script>
{% endblock %}
